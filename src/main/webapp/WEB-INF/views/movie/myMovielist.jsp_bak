<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚´ê°€ ë³¸ ì˜í™”</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="${pageContext.request.contextPath}/css/style.css">
<link rel="stylesheet" href="${pageContext.request.contextPath}/css/layout.css">
<script type="text/javascript" src="${pageContext.request.contextPath}/js/jquery-3.7.1.min.js"></script>
<script>
	$(document).ready(function(){
		$('.close-btn').click(function (){
			const $btn = $(this);
			const resvID = $btn.data('resv-id'); //ì˜ˆì•½ IDì¶”ì¶œ
			
			if(!confirm("ì´ ì˜í™”ë¥¼ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
			
			$.ajax({
				url: '${pageContext.request.contextPath}/deleteReservation.do', //ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤í•‘ ì£¼ì†Œ
				type: 'POST',
				data: {reservationID: resvID},
				success: function (response){
					console.log("ğŸ”µ ì„œë²„ ì‘ë‹µ:", response);
					if(response.trim() === 'success'){
						$btn.closest('.movie-card').remove(); // ì˜í™”ì¹´ë“œ DOMì—ì„œ ì œê±°
					}else{
						alert("ì‚­ì œ ì‹¤íŒ¨:"+ response);
					}	
				  },
				  error: function(){
					  alert("ì„œë²„ ì˜¤ë¥˜ë¡œ ì‚­ì œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
				  }
			});
		});
	});
</script>

</head>

<body>
<%@ include file="/WEB-INF/views/common/header.jsp"%>
<!-- AJAX -->
<script>
	
</script>

<div class="Mylist-wrapper">
  <div class="Mylist-container">
    <!-- Sidebar -->
    <div class="Mylist-sidebar">
      <div class="Mylist-profile">
        <div class="Mylist-avatar"></div>
        <div class="Mylist-username">
          ${reservation.name}ë‹˜ <span class="edit-icon">âœï¸</span>
        </div>
      </div>
      <button class="my-movies-btn">ë‚´ê°€ ë³¸ ì˜í™”</button>
    </div>

    <!-- Main Content -->
    <div class="Mylist-main">
      <h2>ë‚´ê°€ ë³¸ ì˜í™”</h2>

      <c:forEach var="reservation" items="${movieList}">
        <div class="movie-card">
          <img src="${pageContext.request.contextPath}/upload/${reservation.poster_url}"
               alt="${reservation.mvTitle}"
               style="width:150px;height:auto;border-radius:10px; margin-top:10px;">
          <div class="movie-info">
            <h3>${reservation.mvTitle}</h3>
            <p>
              ${reservation.screeningDate}
              ${reservation.startTime} ~ ${reservation.endTime}
            </p>
            <p>${reservation.theaterName} / ${reservation.viewers}ëª…</p>
          </div>
          <button class="close-btn" data-resv-id="${reservation.reservationID}">âœ•</button>
        </div>
        <hr/>
      </c:forEach>

    </div> <!-- Mylist-main -->
  </div>   <!-- Mylist-container -->
</div>     <!-- Mylist-wrapper -->

<%@ include file="/WEB-INF/views/common/footer.jsp"%>
</body>
</html>